<p id="notice"><%= notice %></p>

<h1>All Events</h1>

<!-- header row -->
<div class="row">
  <div class="col-md-2"><b>Name</b></div>
  <div class="col-md-4"><b>Dates</b></div>
  <div class="col-md-2"><b>Location</b></div>
  <div class="col-md-1"><b>Registrations</b></div>
  <div class="col-md-1"></div>
  <div class="col-md-2"></div>
</div>

<ul class="list-group">
  <% @events.each do |event| %>
      <li class="row list-group-item">
        <div class="col-md-2"><%= event.name %></div>
        <div class="col-md-4"><%= event.start.to_formatted_s(:long) %> - <%= event.end.to_formatted_s(:long) %></div>
        <div class="col-md-2"><%= event.location %></div>
        <div class="col-md-1"><%= event.user_events.length %></div>
        <div class="col-md-1"><%= link_to 'Show', event %></div>
        <% if current_user.admin? %>
            <div class="col-md-2">
              <%= link_to 'Edit', edit_event_path(event) %>
              <%= link_to 'Destroy', event, method: :delete, data: {confirm: 'Are you sure?'} %>
            </div>
        <% end %>
      </li>
  <% end %>
</ul>
<hr>

<h2><%= current_user.name %>'s registrations</h2>
<ul class="list-group">
<% current_user.user_events.each do |registration| %>
    <h3><%= link_to "#{registration.event.name} (#{registration.event.start.to_formatted_s(:short)} to #{registration.event.end.to_formatted_s(:short)})", registration.event %></h3>
    <% # Add in their tables %>
      <% sorted = registration.registration_tables.sort { |a,b| a.start <=> b.start} %>
      <% sorted.each do |reg_table| %>
          <li class="row list-group-item"><%= reg_table.table.session.name %>: <%= link_to "#{reg_table.table.scenario.long_name}", reg_table.table.scenario %></li>
      <% end %>
<% end %>
</ul>

<hr>

<% if current_user.admin? %>
    <%= link_to 'New Event', new_event_path %>
    <br>
<% end %>
