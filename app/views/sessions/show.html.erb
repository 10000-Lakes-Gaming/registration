<p id="notice"><%= notice %></p>

<h1><%= @event.name %></h1>
<h2><%= @session.name %>
  <small><%= @session.timeslot %></small>
</h2>

<h3>Scheduled Tables</h3>


<table class="table table-striped">
  <thead>
  <tr>
    <th>Scenario</th>
    <th></th>
    <th width="1%">Players</th>
    <th width="1%">GMs</th>
  </tr>
  </thead>

  <tbody>
  <%
    @session.tables.sort { |a, b| a <=> b }.each do |table| %>
      <tr>
        <td>
          <%# make this show the scenario data as a collapsable %>
          <%= table.scenario.long_name %>
          <span class="badge"><%= table.scenario.tier %></span>
          <% if table.core? %>
              <span class="badge badge-core">Core</span>
          <% end %>
          <% if table.raffle? %>
              <span class="badge badge-raffle">Raffle</span>
          <% end %>
          <% if table.scenario.hard_mode? %>
              <span class="badge badge-hardmode"><small>Hard Mode</small></span>
          <% end %>
          <% if table.scenario.pregen_only? %>
              <span class="badge badge-pregen">Pregen</span>
          <% end %>
          <% if table.scenario.retired? %>
              <span class="badge badge-retired">Retired</span>
          <% end %>
        </td>
        <td>
          <% scenario = table.scenario %>
          <button data-toggle="modal" data-target="#scenario_<%= scenario.id %>" class="btn btn-info">Scenario
            Details
          </button>
          <div id="scenario_<%= scenario.id %>" class="modal fade" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-header"><%= scenario.long_name %></h4>
                </div>
                <div class="modal-body">
                  <div><b>Type:</b>  <%= scenario.type %></div>
                  <% if scenario.pregen_only %>
                      <div class="bg-primary">This scenario is pregen-only.</div>
                  <% end %>
                  <% if scenario.hard_mode %>
                      <div class="bg-primary">This scenario has a hard mode.</div>
                  <% end %>
                  <hr>
                  <div style="white-space: pre-wrap;"><%= scenario.description %></div>
                  <div><strong>Written by:</strong> <%= scenario.author %></div>
                  <div><a href="<%= scenario.paizo_url %>" target="_blank">Click to see on Paizo's site</a>.</div>
                  <div>
                    <% if table.scenario.paizo_url.nil? %>
                        <a href="<%= scenario.paizo_url %>" target="_blank">Click to see on Paizo's site</a>.
                    <% end %>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
        </td>
        <% if admin? %>
            <td>
              <%= link_to "#{@player_sessions.size} / #{table.max_players}", event_session_table_registration_tables_path(@event, @session, table) %>
            </td>
            <td>
              <%= link_to "#{@gm_sessions.size} / #{table.gms_needed}", event_session_table_game_masters_path(@event, @session, table) %>
            </td>
        <% else %>
            <td>
              <%= @player_sessions.size %>/ <%= table.max_players %>
            </td>
            <td>
              <%= @gm_sessions.size %>/ <%= table.gms_needed %>
            </td>
        <% end %>
        <td>
          <% if admin? %>
              <%= button_to 'Show', [@event, @session, table], method: :get, :class => 'btn btn-info' %>
              <%= button_to 'Edit', edit_event_session_table_path(@event, @session, table), method: :get, :class => 'btn btn-primary' %>
              <%= button_to 'Remove', [@event, @session, table], method: :delete, data: {confirm: 'Are you sure?'}, :class => 'btn btn-danger' %>
          <% end %>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>


<% if admin? %>
    <%= button_to 'Add New Table', new_event_session_table_path(@event, @session), method: :get, :class => 'btn btn-warning' %>
    <%= button_to 'Edit', edit_event_session_path(@event, @session), method: :get, :class => 'btn btn-primary' %>
<% end %>
<%= button_to "Back to #{@event.name}", event_path(@event), method: :get, :class => 'btn btn-success' %>

